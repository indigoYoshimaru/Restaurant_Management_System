<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>

<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="//unpkg.com/element-ui@2.14.1/lib/index.js"></script>
<script src="js/client.js"></script>

<body>
    <div id="setup-table-screen">
        <template>
            <el-table ref="singleTable" :data="tableData" highlight-current-row @current-change="handleCurrentChange"
                height="75vh" margin style="width: 75vw">
                <el-table-column prop="Id" label="No." width="75">
                </el-table-column>
                <el-table-column prop="Code" label="Code" width="180">
                </el-table-column>
                <el-table-column prop="tag" label="Status">
                    <template slot-scope="scope">
                        <el-tag :type="scope.row.tag === 'Available' ? 'success' : 'danger'" disable-transitions
                            effect="dark">
                            {{scope.row.tag}}</el-tag>
                    </template>
                </el-table-column>
            </el-table>

            <el-button @click="setUp()">Set Up Table</el-button>

        </template>


    </div>
</body>

<script>

    let mainData = {
        tables: [],
        currentInfo: {},
        items: [],
        combos: [],
        itemsInCombos: [],
        chosenItemIds: [],
        chosenComboIds: [],
        cardNo: {},
        cvv: {}
    }

    var setUpTableScreen = {
        data() {
            return {
                tableData: mainData.tables,
                currentRow: null
            }
        },
        methods: {
            setUp: async function () {

                let result = await setUpTable(this.currentRow.Id);

                mainData.currentInfo = await getCurrentTableInfo();
                alert(result);
                console.log(mainData.currentInfo);

            },
            handleCurrentChange(val) {

                this.currentRow = val;
                console.log(this.currentRow);
            }
        }


    }

    var v;

    getTables().then(async function (result) {
        for (var table of result) {
            let res = await getCurrentBillByTableId(table.Id);
            table.tag = res.tag;
        }
        mainData.tables = result;
        var Ctor = Vue.extend(setUpTableScreen);
        v = new Ctor().$mount('#setup-table-screen')
        return result;
    })

</script>

</html>